<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script type="text/javascript" src="dat.gui.min.js"></script>
  <style>
    body {
      overflow: scroll; /* Show scrollbars */
    }

  </style>
  <title>Title</title>
</head>
<body>
<script>
  var gui = new dat.GUI({
    height : 5 * 32 - 1
  });

  var params = {
    font: 5,
    curve:20,
    show: true
  };
  make_viz(params.font,params.curve)
  gui.add(params, 'font').name('Font Size').min(1).max(10).step(0.5).onFinishChange(function(){
    d3.select("svg").remove()
    make_viz(params.font,params.curve)
  })

  gui.add(params, 'curve').name('Curve Height').min(1).max(30).step(0.5).onFinishChange(function(){
    d3.select("svg").remove()
    make_viz(params.font,params.curve)
  })
 gui.add(params, 'show').name('Text').listen().onChange(function(){

   console.log("hide")
   // Determine if current line is visible
   var active = textshow.active ? false : true,
     newOpacity = active ? 0 : 1;
   // Hide or show the elements
   d3.selectAll("#textshow").style("opacity", newOpacity);
   // Update whether or not the elements are active
   textshow.active = active;


 });



function make_viz(font,curve) {


  var words = []
  var time = []
  var space = []
  var n = 0


  var margin = {top: 50, right: 50, bottom: 50, left: 50}
    , width = window.innerWidth-150 - margin.left - margin.right // Use the window's width
    , height = window.innerHeight  - margin.top - margin.bottom; // Use the window's height

// 10 words per line
  var xScale = d3.scaleLinear()
    .domain([0, 30]) // input
    .range([0, width - 250]); // output

// Y scale input between 0, 1 output in pxls
  var yScale = d3.scaleLinear()
    .domain([0, 0.3]) // input
    .range([-10, 2*curve]); // output

  var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .call(d3.zoom().on("zoom", function () {
      svg.attr("transform", d3.event.transform)
    }))
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


  function makearea(j) {
    var area = d3.area()
      .x(function (d, i) {
        return xScale(i) + d.post_space * 5;
      })
      .y1(function (d, i) {
        return yScale(d.std_time_spent) + 20 * j;
      })
      .y0(function (d, i) {
        return -yScale(d.std_time_spent) + 20 * j;
      })
      .curve(d3.curveMonotoneX);

    return area
  }

  d3.csv("vis_mw_fv_new.csv", function load_data(data) {
    for (var i = 0; i < data.length; i++) {
      words[i] = data[i].Word
      time[i] = data[i].std_time_spent
      space[i] = data[i].post_space
    }
    const data_arr = data

    n = data.length;


    var innerSVG = svg.append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .attr("overflow", "visible")
      .append("g")

    console.log(~~(20 / 8))
    for (let i = 0; i < n; i++) {
      if (i % 30 == 0) {
        area = makearea(~~(i / 30))
        //console.log(grp_data)
        svg.append('path')
          .attr('class', 'area')
          .attr("id", "curve")
          .datum(data_arr.slice(i, i + 30))
          .attr('fill', 'lightsteelblue')
          .attr('opacity', 0.5)
          .attr('d', area);

      }
    }

    for (let i = 0; i < n; i++) {
      innerSVG.attr("id", `textshow`)
        .append("text")
        .attr("text-anchor", "middle")
        .attr("x", (xScale(i) + space[i] * 5) % (width - 250))
        .attr("y", 20 * ~~(i / 30))
        .attr("font-size", font * time[i] + "em")
        .attr("dy", .35 + "em")
        .attr("vertical-align", "middle")
        .text(words[i]);
      //if i%10==0 append p

    }


  });


  /*svg.append("text")
    .attr("id", `showbutton`)
    .attr("text-anchor", "middle")
    .attr("x", width - 200)
    .attr("y", 100)
    .attr("font-size", "2em")
    .attr("dy", ".35em")
    .attr("vertical-align", "middle")
    .attr("paint-order", "stroke")
    .attr("stroke", "#000000")
    .attr("stroke-width", " 1px")
    .text("Hide Text")
    .on("click", function () {
      // Determine if current line is visible
      var active = textshow.active ? false : true,
        newOpacity = active ? 0 : 1;
      // Hide or show the elements
      d3.select("#textshow").style("opacity", newOpacity);
      // Update whether or not the elements are active
      textshow.active = active;
    })*/


}
/*
function linspace(start, stop, num, endpoint = true) {
  const div = endpoint ? (num - 1) : num;
  const step = (stop - start) / div;
  return Array.from({length: num}, (_, i) => start + step * i);
}
 */

</script>

</body>
</html>

